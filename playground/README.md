# ğŸš€ Expression Engine Playground

é«˜æ€§èƒ½ã€å®‰å…¨çš„è¡¨è¾¾å¼å¼•æ“åœ¨çº¿æµ‹è¯•å¹³å°ï¼ŒåŸºäº Vite + React + CodeMirror æ„å»ºã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ å®æ—¶è¡¨è¾¾å¼æµ‹è¯•

- **å·¦ä¾§ç¼–è¾‘åŒº**ï¼šè¡¨è¾¾å¼è¾“å…¥ã€JSON æ•°æ®ã€è‡ªå®šä¹‰å˜é‡
- **å³ä¾§ç»“æœåŒº**ï¼šè®¡ç®—ç»“æœã€éªŒè¯ç»“æœã€å­—ç¬¦ä¸²/AST è¾“å‡ºåˆ‡æ¢

### ğŸ”§ æ™ºèƒ½ä»£ç ç¼–è¾‘

- **è‡ªåŠ¨è¡¥å…¨**ï¼šè¾“å…¥ `{{` è‡ªåŠ¨è¡¥å…¨ `}}`ï¼Œå…‰æ ‡å®šä½åœ¨ä¸­é—´
- **æ™ºèƒ½æç¤º**ï¼šè¾“å…¥ `{{` æ˜¾ç¤ºä»£ç æç¤ºï¼Œé€‰æ‹©åå®Œæ•´æ’å…¥
- **é”™è¯¯æç¤º**ï¼šéªŒè¯ä¸é€šè¿‡çš„è¡¨è¾¾å¼æ˜¾ç¤ºçº¢è‰²ï¼Œhover æ˜¾ç¤ºé”™è¯¯åŸå› 

### ğŸ›¡ï¸ äº”å±‚éªŒè¯ç³»ç»Ÿ

- **è¯­æ³•éªŒè¯**ï¼šJavaScript è¯­æ³•æ£€æŸ¥
- **è¯­ä¹‰éªŒè¯**ï¼šå˜é‡å’Œå‡½æ•°æœ‰æ•ˆæ€§
- **å®‰å…¨éªŒè¯**ï¼šé˜²æ­¢ä»£ç æ³¨å…¥å’ŒåŸå‹æ±¡æŸ“
- **æ€§èƒ½éªŒè¯**ï¼šé˜²æ­¢èµ„æºè€—å°½æ”»å‡»
- **ä¸šåŠ¡éªŒè¯**ï¼šè‡ªå®šä¹‰ä¸šåŠ¡è§„åˆ™

### ğŸ¨ è¡¨è¾¾å¼èƒ½åŠ›å±•ç¤º

- **n8n å…¼å®¹**ï¼šå®Œå…¨å…¼å®¹ n8n å·¥ä½œæµè¡¨è¾¾å¼è¯­æ³•
- **å†…ç½®å˜é‡**ï¼š`$json`ã€`$vars`ã€`$node`ã€`$now` ç­‰
- **å†…ç½®å‡½æ•°**ï¼š`$if`ã€`$length`ã€`$split` ç­‰ 25+ å‡½æ•°
- **æ•°å­¦è®¡ç®—**ï¼š`Math.*` å‡½æ•°æ”¯æŒ
- **æ—¥æœŸå¤„ç†**ï¼šLuxon DateTime æ”¯æŒ
- **JMESPath**ï¼šJSON æŸ¥è¯¢è¯­æ³•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
# å®‰è£… playground ä¾èµ–
pnpm run playground:install

# æˆ–è€…ç›´æ¥åœ¨ playground ç›®å½•ä¸­
cd playground
pnpm install
```

### å¼€å‘æ¨¡å¼

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm run playground:dev

# æˆ–è€…
cd playground
pnpm dev
```

è®¿é—® http://localhost:5173 æŸ¥çœ‹ playground

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
# æ„å»º playground
pnpm run playground:build

# é¢„è§ˆæ„å»ºç»“æœ
pnpm run playground:preview
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. åŸºç¡€è¡¨è¾¾å¼æµ‹è¯•

åœ¨è¡¨è¾¾å¼è¾“å…¥æ¡†è¾“å…¥ï¼š

```javascript
{{ $json.name }} åœ¨ {{ $json.city }} å·¥ä½œ
```

åœ¨ JSON æ•°æ®è¾“å…¥æ¡†è¾“å…¥ï¼š

```json
{
  "name": "å¼ ä¸‰",
  "age": 30,
  "city": "åŒ—äº¬"
}
```

ç‚¹å‡»å³ä¾§æŸ¥çœ‹ç»“æœï¼š`å¼ ä¸‰ åœ¨ åŒ—äº¬ å·¥ä½œ`

### 2. æ•°å­¦è®¡ç®—

```javascript
{
  {
    Math.round($json.age / 10) * 10
  }
}
```

ç»“æœï¼š`30`ï¼ˆå¹´é¾„æŒ‰ 10 å–æ•´ï¼‰

### 3. æ¡ä»¶åˆ¤æ–­

```javascript
{
  {
    $json.age >= 18 ? "æˆå¹´äºº" : "æœªæˆå¹´"
  }
}
```

ç»“æœï¼š`æˆå¹´äºº`

### 4. æ—¥æœŸå¤„ç†

```javascript
{
  {
    $now.toFormat("yyyy-MM-dd HH:mm:ss")
  }
}
```

ç»“æœï¼šå½“å‰æ—¶é—´çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²

### 5. æ•°ç»„æ“ä½œ

JSON æ•°æ®ï¼š

```json
{
  "items": [1, 2, 3, 4, 5],
  "tags": ["JavaScript", "TypeScript", "React"]
}
```

è¡¨è¾¾å¼ï¼š

```javascript
{{ $json.items.length }} ä¸ªæ•°å­—ï¼Œ{{ $json.tags.join(", ") }}
```

ç»“æœï¼š`5 ä¸ªæ•°å­—ï¼ŒJavaScript, TypeScript, React`

### 6. JMESPath æŸ¥è¯¢

JSON æ•°æ®ï¼š

```json
{
  "users": [
    { "name": "Alice", "age": 30, "city": "Beijing" },
    { "name": "Bob", "age": 25, "city": "Shanghai" }
  ]
}
```

è¡¨è¾¾å¼ï¼š

```javascript
{{ $json.users[?age > `28`].name }}
```

ç»“æœï¼š`["Alice"]`

## ğŸ¯ é«˜çº§åŠŸèƒ½

### AST è¾“å‡ºæ¨¡å¼

åˆ‡æ¢åˆ° "AST è¾“å‡º" å¯ä»¥æŸ¥çœ‹è¡¨è¾¾å¼çš„æŠ½è±¡è¯­æ³•æ ‘ç»“æ„ï¼š

```javascript
{
  {
    $json.user.name
  }
}
```

AST è¾“å‡ºï¼š

```json
{
  "type": "Template",
  "dependencies": ["$json"],
  "complexity": 4,
  "parts": [
    {
      "type": "Expression",
      "value": "..."
    }
  ]
}
```

### éªŒè¯ç»“æœåˆ†æ

å³ä¾§éªŒè¯é¢æ¿æ˜¾ç¤ºè¯¦ç»†çš„éªŒè¯ä¿¡æ¯ï¼š

- âœ… **éªŒè¯é€šè¿‡**ï¼šè¡¨è¾¾å¼å®‰å…¨æœ‰æ•ˆ
- âŒ **è¯­æ³•é”™è¯¯**ï¼šJavaScript è¯­æ³•é—®é¢˜
- âš ï¸ **å®‰å…¨è­¦å‘Š**ï¼šæ½œåœ¨çš„å®‰å…¨é£é™©
- ğŸ“Š **æ€§èƒ½ä¿¡æ¯**ï¼šå¤æ‚åº¦å’Œæ‰§è¡Œæ—¶é—´

### è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½

1. è¾“å…¥ `{{` è‡ªåŠ¨è¡¥å…¨ä¸º `{{ }}`
2. è¾“å…¥ `$` æ˜¾ç¤ºæ‰€æœ‰å˜é‡æç¤º
3. è¾“å…¥ `Math.` æ˜¾ç¤ºæ•°å­¦å‡½æ•°
4. è¾“å…¥ `DateTime.` æ˜¾ç¤ºæ—¥æœŸå‡½æ•°
5. é€‰æ‹©å‡½æ•°è‡ªåŠ¨æ’å…¥æ‹¬å·å¹¶å®šä½å…‰æ ‡

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**ï¼šReact 18
- **æ„å»ºå·¥å…·**ï¼šVite 5
- **ç¼–è¾‘å™¨**ï¼šCodeMirror 6
- **è¯­è¨€**ï¼šTypeScript
- **è¡¨è¾¾å¼å¼•æ“**ï¼š@choiceform/expression-engine

## ğŸ“ é¡¹ç›®ç»“æ„

```
playground/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ expression-playground.tsx    # ä¸»ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ expression-editor.tsx        # è¡¨è¾¾å¼ç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ json-editor.tsx             # JSON ç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ vars-editor.tsx             # å˜é‡ç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ result-panel.tsx            # ç»“æœé¢æ¿
â”‚   â”‚   â””â”€â”€ validation-panel.tsx        # éªŒè¯é¢æ¿
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ use-expression-editor.tsx   # ç¼–è¾‘å™¨ hooks
â”‚   â”œâ”€â”€ App.tsx                         # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ main.tsx                        # React å…¥å£
â”œâ”€â”€ package.json                        # ä¾èµ–é…ç½®
â”œâ”€â”€ vite.config.ts                      # Vite é…ç½®
â”œâ”€â”€ tsconfig.json                       # TypeScript é…ç½®
â””â”€â”€ index.html                          # HTML æ¨¡æ¿
```

## ğŸ”§ å¼€å‘è¯´æ˜

### ç»„ä»¶å‘½åè§„èŒƒ

éµå¾ªå…¬å¸è§„å®šï¼šç»„ä»¶åå…¨éƒ¨ä½¿ç”¨å°å†™ + ç ´æŠ˜å·å‘½å

- `expression-playground.tsx`
- `expression-editor.tsx`
- `result-panel.tsx`

### æ ·å¼è®¾è®¡

é‡‡ç”¨ç®€æ´çš„å†…è”æ ·å¼ï¼Œæ— éœ€æ ·å¼ç³»ç»Ÿï¼š

- ç®€å•çš„ CSS å®ç°
- å“åº”å¼ç½‘æ ¼å¸ƒå±€
- æ¸…æ™°çš„è§†è§‰å±‚æ¬¡

### API é›†æˆ

- ä½¿ç”¨ `engine.getCompletions()` è·å–è‡ªåŠ¨è¡¥å…¨
- ä½¿ç”¨ `createDefaultValidationEngine()` è¿›è¡ŒéªŒè¯
- å……åˆ†å±•ç¤ºè¡¨è¾¾å¼å¼•æ“çš„æ‰€æœ‰èƒ½åŠ›

## ğŸš« æ³¨æ„äº‹é¡¹

**playground ä¸ä¼šåŒ…å«åœ¨å‘å¸ƒåŒ…ä¸­**ï¼š

- `package.json` çš„ `files` å­—æ®µåªåŒ…å« `["dist", "src", "README.md"]`
- `.gitignore` å·²é…ç½®å¿½ç•¥ `playground/dist/` ç­‰æ„å»ºäº§ç‰©
- playground æ˜¯ç‹¬ç«‹çš„å¼€å‘å’Œæ¼”ç¤ºå·¥å…·

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åœ¨é¡¹ç›®ä»“åº“æäº¤ Issueã€‚
